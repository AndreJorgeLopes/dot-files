# Compression
compress() { tar -czf "${1%/}.tar.gz" "${1%/}"; }
alias decompress="tar -xzf"

# Write iso file to sd card
iso2sd() {
  if [ $# -ne 2 ]; then
    echo "Usage: iso2sd <input_file> <output_device>"
    echo "Example: iso2sd ~/Downloads/ubuntu-25.04-desktop-amd64.iso /dev/sda"
    echo -e "\nAvailable SD cards:"
    lsblk -d -o NAME | grep -E '^sd[a-z]' | awk '{print "/dev/"$1}'
  else
    sudo dd bs=4M status=progress oflag=sync if="$1" of="$2"
    sudo eject $2
  fi
}

# Create a desktop launcher for a web app
web2app() {
  if [ "$#" -ne 3 ]; then
    echo "Usage: web2app <AppName> <AppURL> <IconURL> (IconURL must be in PNG -- use https://dashboardicons.com)"
    return 1
  fi

  local APP_NAME="$1"
  local APP_URL="$2"
  local ICON_URL="$3"
  local ICON_DIR="$HOME/.local/share/applications/icons"
  local DESKTOP_FILE="$HOME/.local/share/applications/${APP_NAME}.desktop"
  local ICON_PATH="${ICON_DIR}/${APP_NAME}.png"

  mkdir -p "$ICON_DIR"

  if ! curl -sL -o "$ICON_PATH" "$ICON_URL"; then
    echo "Error: Failed to download icon."
    return 1
  fi

  cat > "$DESKTOP_FILE" <<EOF
[Desktop Entry]
Version=1.0
Name=$APP_NAME
Comment=$APP_NAME
Exec=chromium --new-window --ozone-platform=wayland --app="$APP_URL" --name="$APP_NAME" --class="$APP_NAME"
Terminal=false
Type=Application
Icon=$ICON_PATH
StartupNotify=true
EOF

  chmod +x "$DESKTOP_FILE"
}

web2app-remove() {
  if [ "$#" -ne 1 ]; then
    echo "Usage: web2app-remove <AppName>"
    return 1
  fi

  local APP_NAME="$1"
  local ICON_DIR="$HOME/.local/share/applications/icons"
  local DESKTOP_FILE="$HOME/.local/share/applications/${APP_NAME}.desktop"
  local ICON_PATH="${ICON_DIR}/${APP_NAME}.png"

  rm "$DESKTOP_FILE"
  rm "$ICON_PATH"
}

# Search aliases with fzf
function fzf_alias() {
    local selection
    if selection=$(alias | fzf --query="$BUFFER" | sed -re 's/=.+$/ /'); then
        BUFFER=$selection
    fi
}

# Paste the ouput of the last command
function insert-last-command-output() {
  LBUFFER+="$(eval $history[$((HISTCMD-1))])"
}

# Git add and commit alias
function gac() {
    git add .
    if [ "$1" != "" ]
    then
	git commit -m "$1"
    else
	cz
	# echo "Stop being dumb! \n Take a break, get a coffee and run the alias again but this time with a commit message."
    fi
}

# Git worktree add
function gwa() {
    if [ "$1" != "" ]
    then
	git worktree add ../$(echo "$1" | sed "s./.--.g") $2 -b $1 &&
  echo "$2" | grep -qv "^origin/" || git branch --unset-upstream $1;
    else
	echo "0 parameters were provided.- \n $1 = branch \n $2 = options extra parameters"
    fi
}

#Git worktree remove and delete branch
function gwr() {
    WORKTREE_PATH=../$(echo "$1" | sed "s./.--.g")
    git worktree remove $WORKTREE_PATH $2
    if [ "$?" = 0 ]
    then
  echo "Worktree ${WORKTREE_PATH} successfully removed."
  git branch -d $1
    else
  echo "Worktree ${WORKTREE_PATH} returned the following error code. \n Error code: $?"
    fi
}



# Ensure that external keyboards that use an fn key has the F keys as the default
alias fix_fkeys='echo 2 | sudo tee /sys/module/hid_apple/parameters/fnmode'
